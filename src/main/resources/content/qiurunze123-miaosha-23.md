#为什么redis数量会减少为负数

Owner: qiurunze123

Repo: miaosha

Labels: 

## dennymou (08 Jan 2019)

减少为负数可以理解，优化了内存写法和sql写法之后就不会了。。这里的优化具体是指啥优化哦(项目里面没注意到)  redis减少为负数和sql有啥关系涅。。

## dennymou (08 Jan 2019)

还有一个问题觉得有点不妥，限流lua脚本放nginx会不会好一点，在nginx直接就返回了，流量超了根本都不让他进tomcat

## qiurunze123 (08 Jan 2019)

减少为负数是指 剩余1 但是进来了100个请求 发生并发 ！ 优化内存写法 值得是 加了一个内存标记 在redis变为负数的时候 就不会再变了！sql优化 值得是 加了唯一索引 和 大于0 的判断 不会多下单 我可能表述的 有点笼统  限流lua脚本 你说的 很对 放在 nginx里面 更合适 我会改进 ！ 

## qiurunze123 (08 Jan 2019)

good question!!

## dennymou (08 Jan 2019)

多谢回答  没注意到你加的内存标记，我找找，就大概浏览了下你这个项目  整体思路跟我想的思路一样  比现在很多所谓的高并发秒杀靠谱太多

## winrunwang (09 Jan 2019)

如果是用redis管理内存。个人建议是在初始化的时候直接把库存丢进去。然后pop出来。这样就不可能为负啦。但是秒杀的场景是瞬间访问大，需要的是消峰和限流。比如库存只有100.真正进入到db的数据不多，个人觉得 sql加唯一索引 和 大于0 的判断比较合适 

## dennymou (10 Jan 2019)

其实我是觉得redis 会不会小于0没有关系，最终达到限流的效果就ok了， redis小于0就小于0了 不用过于吹毛求疵了哈哈哈


