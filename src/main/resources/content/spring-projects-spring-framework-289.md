#3.2.3.RELEASE introduces bug determining bean name from annotation

Owner: spring-projects

Repo: spring-framework

Labels: 

## nebhale (22 May 2013)

New in `3.2.3.RELEASE` there is a bug in how Spring determines bean names from annotations.  The annotation that is causing the issue looks like:

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Component
public @interface ConfigurationAnalyzer {

    ConfigurationType[] value();
}
```

Based on the stack trace generated by the bug, it's pretty straight forward where [things are going wrong](https://github.com/SpringSource/spring-framework/blob/v3.2.3.RELEASE/spring-context/src/main/java/org/springframework/context/annotation/AnnotationBeanNameGenerator.java#L91).

```plain

java.lang.ClassCastException: [L<REDACTED>.ConfigurationType; cannot be cast to java.lang.String
    at org.springframework.context.annotation.AnnotationBeanNameGenerator.determineBeanNameFromAnnotation(AnnotationBeanNameGenerator.java:91)
    at org.springframework.context.annotation.AnnotationBeanNameGenerator.generateBeanName(AnnotationBeanNameGenerator.java:69)
    at org.springframework.context.annotation.ClassPathBeanDefinitionScanner.doScan(ClassPathBeanDefinitionScanner.java:246)
    at org.springframework.context.annotation.ComponentScanAnnotationParser.parse(ComponentScanAnnotationParser.java:123)
    at org.springframework.context.annotation.ConfigurationClassParser.doProcessConfigurationClass(ConfigurationClassParser.java:191)
    at org.springframework.context.annotation.ConfigurationClassParser.processConfigurationClass(ConfigurationClassParser.java:165)
    at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:140)
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.processConfigBeanDefinitions(ConfigurationClassPostProcessor.java:282)
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry(ConfigurationClassPostProcessor.java:223)
    at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:630)
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:461)
<REDACTED>
```



## jhoeller (22 May 2013)

Hey Ben,

That's unfortunate - not completely unexpected, since the configuration
class processing code has been revised quite a bit - but still, we're
obviously missing a test case there.

Please create a JIRA issue for it, and it'll get fixed ASAP.

Juergen

On Wed, May 22, 2013 at 3:34 PM, Ben Hale notifications@github.com wrote:

> New in 3.2.3.RELEASE there is a bug in how Spring determines bean names
> from annotations. The annotation that is causing the issue looks like:
> 
> `@Retention`(RetentionPolicy.RUNTIME)`@Target`(ElementType.TYPE)`@Componentpublic` `@interface` ConfigurationAnalyzer {
> 
> ```
> ConfigurationType[] value();}
> ```
> 
> Based on the stack trace generated by the bug, it's pretty straight
> forward where things are going wronghttps://github.com/SpringSource/spring-framework/blob/v3.2.3.RELEASE/spring-context/src/main/java/org/springframework/context/annotation/AnnotationBeanNameGenerator.java#L91
> .
> 
> java.lang.ClassCastException: [L<REDACTED>.ConfigurationType; cannot be cast to java.lang.String
> at org.springframework.context.annotation.AnnotationBeanNameGenerator.determineBeanNameFromAnnotation(AnnotationBeanNameGenerator.java:91)
> at org.springframework.context.annotation.AnnotationBeanNameGenerator.generateBeanName(AnnotationBeanNameGenerator.java:69)
> at org.springframework.context.annotation.ClassPathBeanDefinitionScanner.doScan(ClassPathBeanDefinitionScanner.java:246)
> at org.springframework.context.annotation.ComponentScanAnnotationParser.parse(ComponentScanAnnotationParser.java:123)
> at org.springframework.context.annotation.ConfigurationClassParser.doProcessConfigurationClass(ConfigurationClassParser.java:191)
> at org.springframework.context.annotation.ConfigurationClassParser.processConfigurationClass(ConfigurationClassParser.java:165)
> at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:140)
> at org.springframework.context.annotation.ConfigurationClassPostProcessor.processConfigBeanDefinitions(ConfigurationClassPostProcessor.java:282)
> at org.springframework.context.annotation.ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry(ConfigurationClassPostProcessor.java:223)
> at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:630)
> at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:461)
> 
> <REDACTED>
> 
> â€”
> Reply to this email directly or view it on GitHubhttps://github.com/SpringSource/spring-framework/issues/289
> .



## nebhale (23 May 2013)

https://jira.springsource.org/browse/SPR-10580


## nebhale (23 May 2013)

If the GitHub issues are not the proper place to report problems, perhaps the Issues functionality should be disabled for the repository?


